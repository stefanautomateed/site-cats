---
import Base from '../layouts/Base.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

const modules = import.meta.glob('../../content/**/*.mdx', { eager: true });
type PostModule = { frontmatter: any } & Record<string, any>;

const posts: Array<{ title: string; slug: string; date: string; description?: string; cluster?: string; image?: string; }> = Object
  .values(modules)
  .map((m: any) => {
    const fm = (m as PostModule).frontmatter || {};
    return {
      title: fm.title || fm.slug,
      slug: fm.slug,
      date: fm.date || '',
      description: fm.description || '',
      cluster: fm.cluster || 'Uncategorized',
      image: fm.image || undefined
    };
  })
  .filter((p) => !!p.slug);

const clusters = new Map<string, typeof posts>();
for (const post of posts) {
  const list = clusters.get(post.cluster!) || [];
  list.push(post);
  clusters.set(post.cluster!, list);
}

const sortedClusters = Array.from(clusters.entries()).sort(([a], [b]) => a.localeCompare(b));
---
<Base title="Site Index" description="Generated site index">
  <Fragment slot="header"><Header /></Fragment>
  <section style="margin:1rem 0 1.5rem;padding:1.25rem;border:1px solid #1f2937;border-radius:12px;background:#0b1020">
    <h1 style="margin:0 0 .5rem">Welcome</h1>
    <p style="margin:0 0 .75rem;color:#9ca3af">Explore our latest guides and resources.</p>
    <a href="/site/" style="display:inline-block;background:linear-gradient(90deg,#6366f1,#06b6d4);padding:.6rem 1rem;border-radius:10px;color:#fff;text-decoration:none;font-weight:700;">Browse</a>
  </section>

<section style="margin:1rem 0 1.5rem;padding:1.25rem;border:1px solid #1f2937;border-radius:12px;background:#0b1020">
  <h1 style="margin:0 0 .5rem">Gardening Hub: Expert Insights for Thriving Gardens</h1>
  <p style="margin:0 0 .75rem;color:#9ca3af">Discover trusted gardening tips, advice, and solutions to cultivate your perfect outdoor space.</p>
  <a href="/site/" style="display:inline-block;background:linear-gradient(90deg,#6366f1,#06b6d4);padding:.6rem 1rem;border-radius:10px;color:#fff;text-decoration:none;font-weight:700;">Get Started</a>
</section>
<section style="margin:1rem 0 1.5rem;padding:1.25rem;border:1px solid #1f2937;border-radius:12px;background:#0b1020">
  <h1 style="margin:0 0 .5rem">Cats Hub: Expert Insights for Cat Lovers</h1>
  <p style="margin:0 0 .75rem;color:#9ca3af">Your trusted source for helpful tips, health advice, and cat care expertise.</p>
  <a href="/site/" style="display:inline-block;background:linear-gradient(90deg,#6366f1,#06b6d4);padding:.6rem 1rem;border-radius:10px;color:#fff;text-decoration:none;font-weight:700;">Learn More</a>
</section>
<section style="margin:1rem 0 1.5rem;padding:1.25rem;border:1px solid #1f2937;border-radius:12px;background:#0b1020">
  <h1 style="margin:0 0 .5rem">Cats Hub: Expert Insights for Happy, Healthy Cats</h1>
  <p style="margin:0 0 .75rem;color:#9ca3af">Trusted advice and tips from feline experts to help your cat thrive and stay loved.</p>
  <a href="/site/" style="display:inline-block;background:linear-gradient(90deg,#6366f1,#06b6d4);padding:.6rem 1rem;border-radius:10px;color:#fff;text-decoration:none;font-weight:700;">Explore Guides</a>
</section>
<section style="margin:1rem 0 1.5rem;padding:1.25rem;border:1px solid #1f2937;border-radius:12px;background:#0b1020">
  <h1 style="margin:0 0 .5rem">Cats Hub: Expert Insights & Tips for Cat Lovers</h1>
  <p style="margin:0 0 .75rem;color:#9ca3af">Your trusted source for feline care, behavior, and health advice from industry experts.</p>
  <a href="/site/" style="display:inline-block;background:linear-gradient(90deg,#6366f1,#06b6d4);padding:.6rem 1rem;border-radius:10px;color:#fff;text-decoration:none;font-weight:700;">Explore Guides</a>
</section>
<h1 style="margin:1rem 0 1rem;">Latest Posts</h1>
  <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:16px;">
    {posts.slice(0, 24).map((p) => (
      <a href={`/site/${p.slug}/`} style="display:block;background:#0b1020;border:1px solid #1f2937;border-radius:12px;overflow:hidden;color:#e2e8f0;text-decoration:none;">
        {p.image && <img src={p.image} alt={p.title} style="width:100%;height:160px;object-fit:cover;border-bottom:1px solid #1f2937;" />}
        <div style="padding:12px 14px;">
          <div style="font-weight:700;line-height:1.3;">{p.title}</div>
          {p.cluster && <div style="color:#9ca3af;font-size:12px;margin-top:6px;">{p.cluster}</div>}
        </div>
      </a>
    ))}
  </div>
  <section style="margin:2rem 0;">
    <h2>Browse by Category</h2>
    <ul>
      {sortedClusters.map(([clusterName, list]) => (
        <li>
          <a href={`/site/category/${encodeURIComponent(clusterName)}/`}>{clusterName}</a> ({list.length})
        </li>
      ))}
    </ul>
  </section>
  <Fragment slot="footer"><Footer /></Fragment>
</Base>

